@* ============================================================
   AssetFlow.BlazorUI / Pages / Employe / IncidentSuccess.razor
   Page de confirmation après signalement d'incident
   ============================================================ *@

@page "/employe/incident/success"
@using Microsoft.AspNetCore.Components

<div class="success-container">

    <header class="success-header">
        <div class="header-content">
            <a href="/employe/equipements" class="header-logo">
                <div class="logo-icon-wrapper">
                    <svg class="logo-icon" viewBox="0 0 40 40" fill="none">
                        <defs>
                            <linearGradient id="logoGrad2" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#136DEC"/>
                                <stop offset="100%" stop-color="#38bdf8"/>
                            </linearGradient>
                        </defs>
                        <polygon points="20,3 35,11 35,29 20,37 5,29 5,11" fill="url(#logoGrad2)" opacity="0.15"/>
                        <polygon points="20,3 35,11 35,29 20,37 5,29 5,11" fill="none" stroke="url(#logoGrad2)" stroke-width="2"/>
                        <polygon points="20,10 29,15 29,25 20,30 11,25 11,15" fill="url(#logoGrad2)" opacity="0.3"/>
                        <circle cx="20" cy="20" r="4" fill="url(#logoGrad2)"/>
                        <line x1="20" y1="3" x2="20" y2="10" stroke="url(#logoGrad2)" stroke-width="1.5"/>
                        <line x1="20" y1="30" x2="20" y2="37" stroke="url(#logoGrad2)" stroke-width="1.5"/>
                        <line x1="35" y1="11" x2="29" y2="15" stroke="url(#logoGrad2)" stroke-width="1.5"/>
                        <line x1="5" y1="11" x2="11" y2="15" stroke="url(#logoGrad2)" stroke-width="1.5"/>
                        <line x1="35" y1="29" x2="29" y2="25" stroke="url(#logoGrad2)" stroke-width="1.5"/>
                        <line x1="5" y1="29" x2="11" y2="25" stroke="url(#logoGrad2)" stroke-width="1.5"/>
                    </svg>
                </div>
                <div class="logo-brand">
                    <span class="logo-text-asset">Asset</span><span class="logo-text-flow">Flow</span>
                </div>
            </a>
            <div class="header-avatar">
                <span>@GetUserInitials()</span>
            </div>
        </div>
    </header>

    <main class="success-main">
        <div class="success-card">

            @* Icon de succès *@
            <div class="success-icon-wrapper">
                <svg class="success-icon" viewBox="0 0 24 24">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                    <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
            </div>

            @* Titre *@
            <h1 class="success-title">Signalement envoyé avec succès !</h1>

            @* Description *@
            <p class="success-description">
                Votre incident a été enregistré. L'équipe IT a été notifiée via <strong>Microsoft Teams</strong> et reviendra vers vous sous 24h.
            </p>

            @* Détails du ticket *@
            <div class="ticket-details">
                <div class="details-header">
                    <span class="details-label">Détails du ticket</span>
                    <span class="details-badge">EN ATTENTE DE TRAITEMENT</span>
                </div>
                <div class="details-content">
                    <div class="detail-row">
                        <span class="detail-label">Numéro d'incident</span>
                        <span class="detail-value">#@NumeroIncident</span>
                    </div>
                    <div class="detail-row detail-row-border">
                        <span class="detail-label">Date de soumission</span>
                        <span class="detail-value">@DateSoumission</span>
                    </div>
                </div>
            </div>

            @* Boutons d'action *@
            <div class="action-buttons">
                <a href="/employe/equipements" class="btn-primary">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="3" width="7" height="9" rx="1" />
                        <rect x="14" y="3" width="7" height="5" rx="1" />
                        <rect x="14" y="12" width="7" height="9" rx="1" />
                        <rect x="3" y="16" width="7" height="5" rx="1" />
                    </svg>
                    <span>Retour au tableau de bord</span>
                </a>
                <a href="/employe/equipements" class="btn-secondary">
                    <svg viewBox="0 0 24 24">
                        <path d="M8 6h13" />
                        <path d="M8 12h13" />
                        <path d="M8 18h13" />
                        <path d="M3 6h.01" />
                        <path d="M3 12h.01" />
                        <path d="M3 18h.01" />
                    </svg>
                    <span>Voir mes demandes</span>
                </a>
            </div>

            @* Footer meta *@
            <div class="card-meta">
                <p>StockIT Infrastructure Management • v2.4.0</p>
            </div>
        </div>
    </main>

    <footer class="success-footer">
        <a href="#" class="support-link">
            Besoin d'aide supplémentaire ? Contactez le support direct
            <svg viewBox="0 0 24 24">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                <polyline points="15 3 21 3 21 9" />
                <line x1="10" x2="21" y1="14" y2="3" />
            </svg>
        </a>
    </footer>

</div>

@code {
    [Parameter]
    [SupplyParameterFromQuery(Name = "numero")]
    public string? NumeroIncident { get; set; }

    private string DateSoumission { get; set; } = string.Empty;
    private string UserName { get; set; } = "Utilisateur";

    protected override void OnInitialized()
    {
        DateSoumission = DateTime.Now.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("fr-FR"));
        NumeroIncident ??= "INC-2024-001";
    }

    private string GetUserInitials()
    {
        var parts = UserName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        if (parts.Length == 1 && parts[0].Length >= 2)
            return parts[0].Substring(0, 2).ToUpper();
        return "??";
    }
}
