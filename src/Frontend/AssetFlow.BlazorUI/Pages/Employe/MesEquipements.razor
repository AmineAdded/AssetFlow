@* ============================================================
   AssetFlow.BlazorUI / Pages / Employe / MesEquipements.razor
   MISE À JOUR : Sans emojis, 3 par ligne, barre de recherche
   ============================================================ *@

@page "/employe/equipements"
@using AssetFlow.BlazorUI.Services

<div class="employe-layout">

    @* === SIDEBAR === *@
    <aside class="employe-sidebar">

        @* Logo *@
        <div class="sidebar-header">
            <img src="images/logo.png" alt="AssetFlow" class="sidebar-logo" />
        </div>

        @* Navigation *@
        <nav class="sidebar-nav">
            <a href="/employe/equipements" class="nav-link active">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <rect x="2" y="3" width="20" height="14" rx="2" />
                    <path d="M8 21h8M12 17v4" />
                </svg>
                <span class="nav-text">Mes Équipements</span>
            </a>
            <a href="/employe/incident" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path
                    d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3ZM12 9v4M12 17h.01" />
                </svg>
                <span class="nav-text">Signaler un Incident</span>
            </a>
            <a href="/employe/profil" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
                <span class="nav-text">Mon Profil</span>
            </a>
        </nav>

        @* Profile dans le sidebar *@
        <div class="sidebar-profile">
            <div class="profile-avatar">@GetInitials()</div>
            <div class="profile-info">
                <p class="profile-name">@UserName</p>
                <p class="profile-role">@UserRole</p>
            </div>
        </div>

        @* Support Box *@
        <div class="sidebar-support">
            <p class="support-label">SUPPORT IT</p>
            <p class="support-text">Besoin d'aide ?</p>
            <button class="support-btn">Contact</button>
        </div>
    </aside>

    @* === MAIN CONTENT === *@
    <main class="employe-main">

        @* Top Header *@
        <header class="employe-header">
            <div class="header-title-group">
                <h1 class="header-title">Mes Équipements</h1>
                <span class="header-badge">@EquipementsFiltres.Count</span>
            </div>

            @* Barre de recherche *@
            <div class="header-search">
                <svg class="search-icon" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.3-4.3" />
                </svg>
                <input type="text" 
                    class="search-input" 
                    placeholder="Rechercher un équipement..." 
                    value="@SearchQuery"
                    @oninput="OnSearchInput" />
            </div>
        </header>

        @* Scrollable Grid *@
        <div class="employe-content">
            @if (IsLoading)
            {
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Chargement de vos équipements...</p>
                </div>
            }
            else if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <div class="error-state">
                    <svg class="error-icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" />
                        <path d="m15 9-6 6M9 9l6 6" />
                    </svg>
                    <p>@ErrorMessage</p>
                </div>
            }
            else if (EquipementsFiltres.Count == 0 && !string.IsNullOrEmpty(SearchQuery))
            {
                <div class="empty-state">
                    <svg class="empty-icon" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8" />
                        <path d="m21 21-4.3-4.3" />
                    </svg>
                    <p>Aucun équipement trouvé pour "@SearchQuery"</p>
                </div>
            }
            else if (EquipementsFiltres.Count == 0)
            {
                <div class="empty-state">
                    <svg class="empty-icon" viewBox="0 0 24 24">
                        <path
                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                    </svg>
                    <p>Aucun équipement affecté pour le moment.</p>
                </div>
            }
            else
            {
                <div class="equipements-grid">
                    @foreach (var equip in EquipementsFiltres)
                    {
                        <div class="equipment-card">

                            @* Image *@
                            <div class="card-image @(equip.Statut == "Endommage" ? "damaged" : "")">
                                @if (!string.IsNullOrEmpty(equip.ImageUrl))
                                {
                                    <img src="@equip.ImageUrl" alt="@equip.Designation" />
                                }
                                else
                                {
                                    <div class="image-placeholder">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                                        </svg>
                                    </div>
                                }
                            </div>

                            @* Contenu *@
                            <div class="card-content">

                                @* Titre + Badge Statut *@
                                <div class="card-header">
                                    <h3 class="card-title">@equip.Designation</h3>
                                    <span class="status-badge" style="--badge-color: @equip.StatutBadgeColor;">
                                        <span class="badge-dot"></span>
                                        @GetStatutLabel(equip.Statut)
                                    </span>
                                </div>

                                @* Référence *@
                                <p class="card-reference">@equip.Reference</p>

                                @* Date affectation *@
                                <div class="card-date">
                                    <svg class="date-icon" viewBox="0 0 24 24">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                        <path d="M16 2v4M8 2v4M3 10h18" />
                                    </svg>
                                    Assigné le @equip.DateAffectation.ToString("dd/MM/yyyy")
                                </div>

                                @* Bouton détail *@
                                <button class="card-btn" @onclick="() => VoirDetail(equip.AffectationId)">
                                    Voir détail
                                </button>

                            </div>
                        </div>
                    }
                </div>
            }
        </div>

    </main>

</div>